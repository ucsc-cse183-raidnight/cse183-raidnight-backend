[[extend 'layout.html']]

<div class="session">
    <div class="title">
        <h1 class="title is-size-3">Session: [[=game_session.name]]</h1>
    </div>


    <div class="block mt-3 mx-6">
        [[if user == game_session.owner:]]
        <div class="level-right">
            <div class="field has-addons">
                <div class="control">
                    <input type="text" class="input invite-link" value="" id="url">
                </div>
                <div class="control tooltip">
                    <button class="button is-primary is-small copy" onclick="copy()" onmouseout="out()">
                            <span class="tooltiptext" id="copyTooltip">
                                Copy invite link
                            </span>
                        <span class="icon mr-1">
                                <i class="far fa-copy"></i>
                            </span>
                    </button>
                </div>
            </div>
        </div>
        [[pass]]

        <div class="section">
            <h4 class="title is-4">Description: </h4>
            <p>[[=game_session.description]]</p>
        </div>

        <div class="section">
            <h4 class="title is-4">Signups: </h4>

            [[if len(signups) == 0:]]
            <p>There are no signups yet.</p>
            <p>Copy the invite link above to invite people.</p>
            [[else:]]

            <table class="table is-fullwidth is-striped">
                <thead>
                <tr>
                    <th>Username</th>
                    <th class="pl-0">Roles</th>
                    <th class="has-text-right">Actions</th>
                </tr>
                </thead>
                <tbody>
                [[for signup in signups:]]
                <tr>
                    <td>
                        [[=signup.username]]
                    </td>
                    <td class="is-vcentered">
                        <div class="columns">
                            [[for role in signup.roles:]]
                            <div class="column is-narrow p-0 pr-1">
                                <figure class="image is-24x24">
                                    [[the_role = game_session.get_role(role.role_id)]]
                                    <img src="[[=the_role.icon_url if the_role is not None else 'img/noclass.png']]">
                                </figure>
                            </div>
                            [[pass]]
                        </div>
                    </td>
                    <td class="has-text-right">
                        [[if signup.user is None or user == signup.user:]]

                        <a class="button is-primary is-small edit-signup" style="border-radius: 13px"
                           href="[[=URL('sessions', session_id, 'edit_signup', signup.id)]]">
                            edit signup
                        </a>
                        [[pass]]
                        [[if signup.user is None or user == signup.user or user == game_session.owner:]]
                        <a class="button is-danger is-small edit-signup ml-2" style="border-radius: 13px"
                           href="[[=URL('sessions', session_id, 'delete_signup', signup.id, signer=url_signer)]]">
                            delete signup
                        </a>
                        [[pass]]
                    </td>
                </tr>
                [[pass]]
                </tbody>
            </table>
            [[pass]]
        </div>


        <div class="section">
            <div>
                <h4 class="title is-4 mb-5">Optimal times & roles: </h4>
            </div>
            <div class="columns">
                [[for op in optimal:]]
                <div class="column is-one-third">
                    <div>
                        <b class="tag my-2 is-medium">time: [[=op["time_start"] ]] - [[=op["time_end"] ]]</b>
                        [[for signup, role in op["solution_list"]: ]]
                        <div class="field has-addons">
                            <div class="control">
                                <tag class="tag is-normal">[[=signup]]</tag>
                            </div>

                            <div class="control mt-1 ml-2">
                                <p>[[=role]]</p>
                            </div>

                        </div>
                        [[pass]]
                        <!-- delete dummy data-->
                        <div class="field has-addons">
                            <div class="control">
                                <tag class="tag is-normal">[[=signup]]</tag>
                            </div>
                            <div class="control mt-1 ml-2">
                                <p>[[=role]]</p>
                            </div>
                        </div>
                        <div class="field has-addons">
                            <div class="control">
                                <tag class="tag is-normal">ddd12#3389</tag>
                            </div>
                            <div class="control mt-1 ml-2">
                                <p>Paladin</p>
                            </div>
                        </div>
                        <div class="field has-addons">
                            <div class="control">
                                <tag class="tag is-normal">ddd12#3389</tag>
                            </div>
                            <div class="control mt-1 ml-2">
                                <p>Paladin</p>
                            </div>
                        </div>
                        <div class="field has-addons">
                            <div class="control">
                                <tag class="tag is-normal">howmanycharactersisthisnotenough#3389</tag>
                            </div>
                            <div class="control mt-1 ml-2">
                                <p>Paladin</p>
                            </div>
                        </div>
                        <!-- dummy data-->
                    </div>
                </div>
                [[pass]]
            </div>
        </div>

        <div class="mt-3 level-right">
            [[if user == game_session.owner:]]
            <a class="button is-primary" href="[[=URL('sessions', session_id, 'edit')]]">
                Edit Session
            </a>
            <a class="button is-primary ml-2" href="[[=URL('sessions', session_id, 'delete')]]">
                Delete Session
            </a>
            [[pass]]
        </div>
    </div>

</div>
<script>
    let url = new URL("../invite/[[=key]]", document.baseURI).href;
    console.log(url)
    document.getElementById("url").value = url;

    function copy() {
        let copyUrl = document.getElementById("url");
        copyUrl.select();
        document.execCommand("copy");
        let tooltip = document.getElementById("copyTooltip")
        tooltip.innerHTML = "Copied";
    }

    function out() {
        let tooltip = document.getElementById("copyTooltip")
        tooltip.innerHTML = "Copy invite link";
    }
</script>